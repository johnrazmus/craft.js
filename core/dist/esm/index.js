import e,{createContext as t,useContext as n,useMemo as r,useState as o,useEffect as a,useRef as i,Fragment as d,Children as s}from"react";import{defineEventListener as c,Handlers as u,useCollector as l,RenderIndicator as f,getDOMInfo as p,deprecationWarning as v,useEffectOnce as h,ERROR_TOP_LEVEL_ELEMENT_NO_ID as y,ROOT_NODE as m,ERROR_DELETE_TOP_LEVEL_NODE as g,ERROR_INVALID_NODEID as N,ERROR_NOPARENT as E,DEPRECATED_ROOT_NODE as b,ERROR_MOVE_TOP_LEVEL_NODE as O,ERROR_MOVE_NONCANVAS_CHILD as k,ERROR_CANNOT_DRAG as C,ERROR_MOVE_TO_NONCANVAS_PARENT as j,ERROR_MOVE_INCOMING_PARENT as P,ERROR_MOVE_CANNOT_DROP as T,ERROR_MOVE_TO_DESCENDANT as w,ERROR_DUPLICATE_NODEID as x,ERROR_MOVE_OUTGOING_PARENT as I,ERROR_INVALID_NODE_ID as D,ERROR_NOT_IN_RESOLVER as q,useMethods as L}from"@craftjs/utils";export{ROOT_NODE}from"@craftjs/utils";import R from"tiny-invariant";import{produce as S}from"immer";import z from"shortid";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function A(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var F=function(){return(F=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function M(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function H(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,d=a.length;i<d;i++,o++)r[o]=a[i];return r}var W=t(null),J=function(){return n(W)},B=function(e){var t=e.target.cloneNode(!0),n=e.target.getBoundingClientRect(),r=n.height;return t.style.width=n.width+"px",t.style.height=r+"px",t.style.position="fixed",t.style.left="-100%",t.style.top="-100%",document.body.appendChild(t),e.dataTransfer.setDragImage(t,0,0),t},V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return A(t,e),t.prototype.handlers=function(){var e=this;return{select:{init:function(){return function(){return e.store.actions.setNodeEvent("selected",null)}},events:[c("mousedown",(function(t,n){t.craft.stopPropagation(),e.store.actions.setNodeEvent("selected",n)}))]},hover:{init:function(){return function(){return e.store.actions.setNodeEvent("hovered",null)}},events:[c("mouseover",(function(t,n){t.craft.stopPropagation(),e.store.actions.setNodeEvent("hovered",n)}))]},drop:{events:[c("dragover",(function(e){e.craft.stopPropagation(),e.preventDefault()})),c("dragenter",(function(n,r){n.craft.stopPropagation(),n.preventDefault();var o=t.draggedElement;if(o){var a=e.store.query.getDropPlaceholder(o.rootNodeId?o.nodes[o.rootNodeId]:o,r,{x:n.clientX,y:n.clientY});a&&(e.store.actions.setIndicator(a),t.events={indicator:a})}}))]},drag:{init:function(t,n){return e.store.query.node(n).isDraggable()?(t.setAttribute("draggable","true"),function(){return t.setAttribute("draggable","false")}):function(){}},events:[c("dragstart",(function(n,r){n.craft.stopPropagation(),e.store.actions.setNodeEvent("dragged",r),t.draggedElementShadow=B(n),t.draggedElement=r})),c("dragend",(function(t){t.craft.stopPropagation(),e.dropElement((function(t,n){return e.store.actions.move(t,n.parent.id,n.index+("after"===n.where?1:0))}))}))]},create:{init:function(e){return e.setAttribute("draggable","true"),function(){return e.removeAttribute("draggable")}},events:[c("dragstart",(function(n,r){n.craft.stopPropagation();var o=e.store.query.parseReactElement(r).toNodeTree();t.draggedElementShadow=B(n),t.draggedElement=o})),c("dragend",(function(t){t.craft.stopPropagation(),e.dropElement((function(t,n){e.store.actions.addNodeTree(t,n.parent.id,n.index+("after"===n.where?1:0))}))}))]}}},t.prototype.dropElement=function(e){var n=t.draggedElement,r=t.draggedElementShadow,o=t.events;n&&o.indicator&&!o.indicator.error&&e(n,o.indicator.placement),r&&(r.parentNode.removeChild(r),t.draggedElementShadow=null),t.draggedElement=null,t.events.indicator=null,this.store.actions.setIndicator(null),this.store.actions.setNodeEvent("dragged",null)},t.prototype.derive=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new(e.bind.apply(e,H([void 0,this.store,this],t)))},t.events={indicator:null},t}(u),X=function(e){function t(t,n){var r=e.call(this,t)||this;return r.derived=n,r}return A(t,e),t}(u),Y=t({});function G(e){var t=J(),o=n(Y),a=l(o,e),i=r((function(){return t&&t.connectors()}),[t]);return F(F({},a),{connectors:i||{},inContext:!!o,store:o})}var K=function(t){var n,o,a,i,d,s,c,u,l=t.children,v=G((function(e){return{events:e.events,indicator:e.options.indicator}})),h=v.events,y=v.indicator,m=v.store,g=r((function(){return new V(m)}),[m]);return e.createElement(W.Provider,{value:g},h.indicator&&e.createElement(f,{style:F(F({},(n=h.indicator.placement,o=p(h.indicator.placement.parent.dom),a=h.indicator.placement.currentNode&&p(h.indicator.placement.currentNode.dom),i=0,d=0,s=0,c=0,u=n.where,a?a.inFlow?(s=a.outerWidth,c=2,i="before"===u?a.top:a.bottom,d=a.left):(s=2,c=a.outerHeight,i=a.top,d="before"===u?a.left:a.left+a.outerWidth):o&&(i=o.top+o.padding.top,d=o.left,s=o.outerWidth,c=2),{top:i+"px",left:d+"px",width:s+"px",height:c+"px"})),{backgroundColor:h.indicator.error?y.error:y.success,transition:"0.2s ease-in"})}),l)},Q=function(e){function t(t,n,r){var o=e.call(this,t,n)||this;return o.id=r,o}return A(t,e),t.prototype.handlers=function(){var e=this,t=this.derived.connectors();return{connect:{init:function(n){t.select(n,e.id),t.hover(n,e.id),t.drop(n,e.id),e.store.actions.setDOM(e.id,n)}},drag:{init:function(n){t.drag(n,e.id)}}}},t}(X),U=e.createContext(null),Z=function(t){var n=t.id,o=t.related,a=void 0!==o&&o,i=t.children,d=J(),s=G((function(e){return{hydrationTimestamp:e.nodes[n]&&e.nodes[n]._hydrationTimestamp}})).hydrationTimestamp,c=r((function(){return d.derive(Q,n).connectors()}),[d,s,n]);return e.createElement(U.Provider,{value:{id:n,related:a,connectors:c}},i)};function $(e){var t=n(U),o=t.id,a=t.related,i=t.connectors,d=G((function(t){return o&&t.nodes[o]&&e&&e(t.nodes[o])})),s=d.actions,c=M(d,["actions","query"]),u=r((function(){return{setProp:function(e,t){t?s.history.throttle(t).setProp(o,e):s.setProp(o,e)},setCustom:function(e,t){t?s.history.throttle(t).setCustom(o,e):s.setCustom(o,e)},setHidden:function(e){return s.setHidden(o,e)}}}),[s,o]);return F(F({},c),{id:o,related:a,inNodeContext:!!t,actions:u,connectors:i})}function ee(e){var t=$(e),n=t.id,r=t.related,o=t.actions,a=t.inNodeContext,i=t.connectors,d=M(t,["id","related","actions","inNodeContext","connectors"]);return F(F({},d),{actions:o,id:n,related:r,setProp:function(e){return v("useNode().setProp()",{suggest:"useNode().actions.setProp()"}),o.setProp(e)},inNodeContext:a,connectors:i})}var te=function(t){var n=t.render,r=ee().connectors;return"string"==typeof n.type?(0,r.connect)((0,r.drag)(e.cloneElement(n))):n},ne=function(){var t=$((function(e){return{type:e.data.type,props:e.data.props,nodes:e.data.nodes,hydrationTimestamp:e._hydrationTimestamp}})),n=t.type,o=t.props,a=t.nodes;return r((function(){var t=e.createElement(n,o,e.createElement(e.Fragment,null,a?a.map((function(t){return e.createElement(oe,{id:t,key:t})})):o&&o.children));return"string"==typeof n?e.createElement(te,{render:t}):t}),[n,o,t.hydrationTimestamp,a])},re=function(){var t=$((function(e){return{hidden:e.data.hidden}})).hidden,n=G((function(e){return{onRender:e.options.onRender}})).onRender;return t?null:e.createElement(n,{render:e.createElement(ne,null)})},oe=e.memo((function(t){return e.createElement(Z,{id:t.id},e.createElement(re,null))})),ae={is:"div",canvas:!1,custom:{},hidden:!1},ie={is:"type",canvas:"isCanvas"};function de(t){var n=t.id,r=t.children,a=M(t,["id","children"]),i=F(F({},ae),a),d=i.is,s=M(i,["is","custom","canvas"]),c=G(),u=c.query,l=c.actions,f=$((function(e){return{node:{id:e.id,data:e.data}}})),p=f.node,v=f.inNodeContext,m=o(null),g=m[0],N=m[1];return h((function(){R(!!n,y);var t=p.id,o=p.data;if(v){var i,c=o.linkedNodes&&o.linkedNodes[n]&&u.node(o.linkedNodes[n]).get();if(c&&c.data.type===d){i=c.id;var f=F(F({},c.data.props),s);l.history.ignore().setProp(i,(function(e){return Object.keys(f).forEach((function(t){return e[t]=f[t]}))}))}else{var h=e.createElement(de,a,r),m=u.parseReactElement(h).toNodeTree();i=m.rootNodeId,l.history.ignore().addLinkedNodeFromTree(m,t,n)}N(i)}})),g?e.createElement(oe,{id:g}):null}var se=function(){return v("<Canvas />",{suggest:"<Element canvas={true} />"})};function Canvas(t){var n=M(t,[]);return a((function(){return se()}),[]),e.createElement(de,F({},n,{canvas:!0}))}var ce=function(t){var n=t.children,r=t.json,d=t.data,s=G(),c=s.actions,u=s.query,l=o(null),f=l[0],p=l[1];r&&v("<Frame json={...} />",{suggest:"<Frame data={...} />"});var h=i({initialChildren:n,initialData:d||r});return a((function(){var t=h.current,n=t.initialChildren,r=t.initialData;if(r)c.history.ignore().deserialize(r);else if(n){var o=e.Children.only(n),a=u.parseReactElement(o).toNodeTree((function(e,t){return t===o&&(e.id=m),e}));c.history.ignore().addNodeTree(a)}p(e.createElement(oe,{id:m}))}),[c,u]),f},ue=function(e){return M(e,["addLinkedNodeFromTree","setDOM","setNodeEvent","replaceNodes","reset"])};function le(e){var t=G(e),n=t.connectors,o=t.actions,a=M(t.query,["deserialize"]),i=t.store,d=M(t,["connectors","actions","query","store"]),s=ue(o),c=r((function(){return F(F({},s),{selectNode:function(e){o.setNodeEvent("selected",e),o.setNodeEvent("hovered",null)},history:F(F({},s.history),{ignore:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return ue((e=s.history).ignore.apply(e,t))},throttle:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return ue((e=s.history).throttle.apply(e,t))}})})}),[s,o]);return F({connectors:n,actions:c,query:a,store:i},d)}function fe(t){return function(n){return function(r){var o=t?le(t):le();return e.createElement(n,F({},o,r))}}}function pe(t){return function(n){return function(r){var o=ee(t);return e.createElement(n,F({},o,r))}}}var ve=function(e){return Object.fromEntries?Object.fromEntries(e):e.reduce((function(e,t){var n,r=t[0],o=t[1];return F(F({},e),((n={})[r]=o,n))}),{})},he=z;function ye(t,n){var r=t.data.type,o=t.id||he();return S({},(function(a){if(a.id=o,a._hydrationTimestamp=Date.now(),a.data=F({type:r,props:F({},t.data.props),name:"string"==typeof r?r:r.name,displayName:"string"==typeof r?r:r.name,custom:{},isCanvas:!1,hidden:!1,nodes:[],linkedNodes:{}},t.data),a.related={},a.events={selected:!1,dragged:!1,hovered:!1},a.rules=F({canDrag:function(){return!0},canDrop:function(){return!0},canMoveIn:function(){return!0},canMoveOut:function(){return!0}},r.craft&&r.craft.rules||{}),a.data.type===de||a.data.type===Canvas){var i=a.data.type===Canvas,d=F(F({},ae),a.data.props);Object.keys(ae).forEach((function(e){a.data[ie[e]||e]=d[e],delete a.data.props[e]})),r=a.data.type,i&&(a.data.isCanvas=!0,se())}if(n&&n(a),r.craft){a.data.props=F(F({},r.craft.props||r.craft.defaultProps||{}),a.data.props);var s=r.craft.displayName||r.craft.name;if(s&&(a.data.displayName=s),r.craft.isCanvas&&(a.data.isCanvas=a.data.isCanvas||r.craft.isCanvas),r.craft.rules&&Object.keys(r.craft.rules).forEach((function(e){["canDrag","canDrop","canMoveIn","canMoveOut"].includes(e)&&(a.rules[e]=r.craft.rules[e])})),r.craft.custom&&(a.data.custom=F(F({},r.craft.custom),a.data.custom)),r.craft.related){a.related={};var c={id:a.id,related:!0};Object.keys(r.craft.related).forEach((function(t){a.related[t]=function(){return e.createElement(Z,c,e.createElement(r.craft.related[t]))}}))}}}))}var me=function(e,t){var n,r;if(t.length<1)return(n={})[e.id]=e,n;var o=t.map((function(e){return e.rootNodeId})),a=F(F({},e),{data:F(F({},e.data),{nodes:o})}),i=((r={})[e.id]=a,r);return t.reduce((function(t,n){var r,o=n.nodes[n.rootNodeId];return F(F(F({},t),n.nodes),((r={})[o.id]=F(F({},o),{data:F(F({},o.data),{parent:e.id})}),r))}),i)},ge=function(e,t){return{rootNodeId:e.id,nodes:me(e,t)}},Ne=function(e,t){var n=t.name||t.displayName;if(t===Canvas)return"Canvas";if(e[n])return n;for(var r=0;r<Object.keys(e).length;r++){var o=Object.keys(e)[r];if(e[o]===t)return o}return"string"==typeof t?t:void 0},Ee=function(t,n,r){var o=t.props,a=function(e,t){return"object"==typeof e&&e.resolvedName?"Canvas"===e.resolvedName?Canvas:t[e.resolvedName]:"string"==typeof e?e:null}(t.type,n);if(a){o=Object.keys(o).reduce((function(e,t){var r=o[t];return e[t]="object"==typeof r&&r.resolvedName?Ee(r,n):"children"===t&&Array.isArray(r)?r.map((function(e){return"string"==typeof e?e:Ee(e,n)})):r,e}),{}),r&&(o.key=r);var i=F({},e.createElement(a,F({},o)));return F(F({},i),{name:Ne(n,i.type)})}},be=function(e,t){var n=M(e,["type","props"]),r=Ee(e,t),o=r.name;return{type:r.type,name:o,displayName:n.displayName||o,props:r.props,custom:n.custom||{},isCanvas:!!n.isCanvas,hidden:!!n.hidden,parent:n.parent,linkedNodes:n.linkedNodes||n._childCanvas||{},nodes:n.nodes||[]}},Oe=function(e,t){return"string"==typeof e?e:{resolvedName:Ne(t,e)}},ke=function(e,t){var n=e.type,r=e.isCanvas,o=e.props;return o=Object.keys(o).reduce((function(e,n){var r=o[n];return r?(e[n]="children"===n&&"string"!=typeof r?s.map(r,(function(e){return"string"==typeof e?e:ke(e,t)})):r.type?ke(r,t):r,e):e}),{}),{type:Oe(n,t),isCanvas:!!r,props:o}},Ce=function(e,t){var n=e.type,r=e.props,o=e.isCanvas,a=M(e,["type","props","isCanvas","name"]),i=ke({type:n,isCanvas:o,props:r},t);return F(F({},i),a)};function je(t){var n=t&&t.options,r=function(){return je(t)};return{getDropPlaceholder:function(e,n,o,a){if(void 0===a&&(a=function(e){return t.nodes[e.id].dom}),e!==n){var i="string"==typeof e&&t.nodes[e],d=t.nodes[n],s=r().node(d.id).isCanvas()?d:t.nodes[d.data.parent];if(s){var c=s.data.nodes||[],u=function(e,t,n,r){for(var o={parent:e,index:0,where:"before"},a=0,i=0,d=0,s=0,c=0,u=0,l=0,f=t.length;l<f;l++){var p=t[l];if(u=p.top+p.outerHeight,s=p.left+p.outerWidth/2,c=p.top+p.outerHeight/2,!(i&&p.left>i||d&&c>=d||a&&p.left+p.outerWidth<a))if(o.index=l,p.inFlow){if(r<c){o.where="before";break}o.where="after"}else r<u&&(d=u),n<s?(i=s,o.where="before"):(a=s,o.where="after")}return o}(s,c?c.reduce((function(e,n){var r=a(t.nodes[n]);if(r){var o=F({id:n},p(r));e.push(o)}return e}),[]):[],o.x,o.y),l=c.length&&t.nodes[c[u.index]],f={placement:F(F({},u),{currentNode:l}),error:!1};return i&&r().node(i.id).isDraggable((function(e){return f.error=e})),r().node(s.id).isDroppable(e,(function(e){return f.error=e})),f}}},getOptions:function(){return n},node:function(e){return function e(t,n){R("string"==typeof n,D);var r=t.nodes[n],o=function(n){return e(t,n)};return{isCanvas:function(){return!!r.data.isCanvas},isRoot:function(){return r.id===m},isLinkedNode:function(){return r.data.parent&&o(r.data.parent).linkedNodes().includes(r.id)},isTopLevelNode:function(){return this.isRoot()||this.isLinkedNode()},isDeletable:function(){return!this.isTopLevelNode()},isParentOfTopLevelNodes:function(){return r.data.linkedNodes&&Object.keys(r.data.linkedNodes).length>0},isParentOfTopLevelCanvas:function(){return v("query.node(id).isParentOfTopLevelCanvas",{suggest:"query.node(id).isParentOfTopLevelNodes"}),this.isParentOfTopLevelNodes()},get:function(){return r},ancestors:function(e){return void 0===e&&(e=!1),function n(r,o,a){void 0===o&&(o=[]),void 0===a&&(a=0);var i=t.nodes[r];return i?(o.push(r),i.data.parent?((e||!e&&0===a)&&(o=n(i.data.parent,o,a+1)),o):o):o}(r.data.parent)},descendants:function(e,r){return void 0===e&&(e=!1),function n(a,i,d){return void 0===i&&(i=[]),void 0===d&&(d=0),(e||!e&&0===d)&&t.nodes[a]?("childNodes"!==r&&o(a).linkedNodes().forEach((function(e){i.push(e),i=n(e,i,d+1)})),"linkedNodes"!==r&&o(a).childNodes().forEach((function(e){i.push(e),i=n(e,i,d+1)})),i):i}(n)},linkedNodes:function(){return Object.values(r.data.linkedNodes||{})},childNodes:function(){return r.data.nodes||[]},isDraggable:function(n){try{var a=r;return R(!this.isTopLevelNode(),O),R(e(t,a.data.parent).isCanvas(),k),R(a.rules.canDrag(a,o),C),!0}catch(e){return n&&n(e),!1}},isDroppable:function(e,n){var a="object"==typeof e&&!t.nodes[e.id],i=function(e){return"string"==typeof e?t.nodes[e]:e}(e),d=r;try{if("string"==typeof e&&R(!o(e).isTopLevelNode(),O),R(this.isCanvas(),j),R(d.rules.canMoveIn(i,d,o),P),R(i.rules.canDrop(d,i,o),T),a)return!0;var s=o(i.id).descendants(!0);R(!s.includes(d.id)&&d.id!==i.id,w);var c=i.data.parent&&t.nodes[i.data.parent];return R(c.data.isCanvas,k),R(c||!c&&!t.nodes[i.id],x),r!==c&&R(c.rules.canMoveOut(i,c,o),I),!0}catch(e){return n&&n(e),!1}},toSerializedNode:function(){return Ce(r.data,t.options.resolver)},toNodeTree:function(e){var t=H([n],this.descendants(!0,e)).reduce((function(e,t){return e[t]=o(t).get(),e}),{});return{rootNodeId:n,nodes:t}},decendants:function(e){return void 0===e&&(e=!1),v("query.node(id).decendants",{suggest:"query.node(id).descendants"}),this.descendants(e)},isTopLevelCanvas:function(){return!this.isRoot()&&!r.data.parent}}}(t,e)},getSerializedNodes:function(){var e=this,n=Object.keys(t.nodes).map((function(t){return[t,e.node(t).toSerializedNode()]}));return ve(n)},serialize:function(){return JSON.stringify(this.getSerializedNodes())},parseReactElement:function(n){return{toNodeTree:function(o){var a=function(t,n){var r=t;return"string"==typeof r&&(r=e.createElement(d,{},r)),ye({data:{type:r.type,props:F({},r.props)}},(function(e){n&&n(e,r)}))}(n,(function(e,n){var r=Ne(t.options.resolver,e.data.type);R(null!==r,q),e.data.displayName=e.data.displayName||r,e.data.name=r,o&&o(e,n)})),i=[];return n.props&&n.props.children&&(i=e.Children.toArray(n.props.children).reduce((function(t,n){return e.isValidElement(n)&&t.push(r().parseReactElement(n).toNodeTree(o)),t}),[])),ge(a,i)}}},parseSerializedNode:function(e){return{toNode:function(n){var o=be(e,t.options.resolver);R(o.type,q);var a="string"==typeof n&&n;return a&&v("query.parseSerializedNode(...).toNode(id)",{suggest:"query.parseSerializedNode(...).toNode(node => node.id = id)"}),r().parseFreshNode(F(F({},a?{id:a}:{}),{data:o})).toNode(!a&&n)}}},parseFreshNode:function(e){return{toNode:function(n){return ye(e,(function(e){e.data.parent===b&&(e.data.parent=m);var r=Ne(t.options.resolver,e.data.type);R(null!==r,q),e.data.displayName=e.data.displayName||r,e.data.name=r,n&&n(e)}))}}},createNode:function(e,t){v("query.createNode("+e+")",{suggest:"query.parseReactElement("+e+").toNodeTree()"});var n=this.parseReactElement(e).toNodeTree(),r=n.nodes[n.rootNodeId];return t?(t.id&&(r.id=t.id),t.data&&(r.data=F(F({},r.data),t.data)),r):r}}}var Pe={nodes:{},events:{dragged:null,selected:null,hovered:null,indicator:null},options:{onNodesChange:function(){return null},onRender:function(e){return e.render},resolver:{},nodes:null,enabled:!0,indicator:{error:"red",success:"rgb(98, 196, 98)"}}},Te={methods:function(e,t){var n=function(t,n,r){var a=o(n);a.data.nodes||(a.data.nodes=[]),a.data.props.children&&delete a.data.props.children,null!=r?a.data.nodes.splice(r,0,t.id):a.data.nodes.push(t.id),t.data.parent=a.id,e.nodes[t.id]=t},r=function(t,o,a){var i=t.nodes[t.rootNodeId];if(null!=o&&n(i,o,a),i.data.nodes){var d=H(i.data.nodes);i.data.nodes=[],d.forEach((function(e,n){return r({rootNodeId:e,nodes:t.nodes},i.id,n)}))}i.data.linkedNodes&&Object.keys(i.data.linkedNodes).forEach((function(n){var o=i.data.linkedNodes[n];e.nodes[o]=t.nodes[o],r({rootNodeId:o,nodes:t.nodes})}))},o=function(t){R(t,E);var n=e.nodes[t];return R(n,N),n},a=function(t,n){void 0===n&&(n=!1);var r=e.nodes[t],o=e.nodes[r.data.parent];if(r.data.nodes&&H(r.data.nodes).forEach((function(e){return a(e)})),n&&o.data.linkedNodes){var i=Object.keys(o.data.linkedNodes).filter((function(e){return o.data.linkedNodes[e]===e}))[0];i&&delete o.data.linkedNodes[i]}else{var d=o.data.nodes;d.splice(d.indexOf(t),1)}!function(e,t,n){Object.keys(e.events).forEach((function(n){e.events[n]&&e.events[n]===t&&(e.events[n]=null)}))}(e,t),delete e.nodes[t]};return{addLinkedNodeFromTree:function(t,n,i){var d=o(n);d.data.linkedNodes||(d.data.linkedNodes={});var s=d.data.linkedNodes[i];s&&a(s,!0),d.data.linkedNodes[i]=t.rootNodeId,t.nodes[t.rootNodeId].data.parent=n,e.nodes[t.rootNodeId]=t.nodes[t.rootNodeId],r(t)},add:function(e,t,r){var o=[e];Array.isArray(e)&&(v("actions.add(node: Node[])",{suggest:"actions.add(node: Node)"}),o=e),o.forEach((function(e){n(e,t,r)}))},addNodeTree:function(t,n,o){var a=t.nodes[t.rootNodeId];n||(R(t.rootNodeId===m,"Cannot add non-root Node without a parent"),e.nodes[t.rootNodeId]=a),r(t,n,o)},delete:function(e){R(!t.node(e).isTopLevelNode(),g),a(e)},deserialize:function(e){var n="string"==typeof e?JSON.parse(e):e,r=Object.keys(n).map((function(e){var r=e;return e===b&&(r=m),[r,t.parseSerializedNode(n[e]).toNode((function(e){return e.id=r}))]}));this.replaceNodes(ve(r))},move:function(n,r,o){var a=e.nodes[n],i=a.data.parent,d=e.nodes[r].data.nodes;t.node(r).isDroppable(a,(function(e){throw new Error(e)}));var s=e.nodes[i].data.nodes;s[s.indexOf(n)]="marked",d.splice(o,0,n),e.nodes[n].data.parent=r,s.splice(s.indexOf("marked"),1)},replaceNodes:function(t){e.nodes=t,this.clearEvents()},clearEvents:function(){e.events=Pe.events},reset:function(){this.replaceNodes({}),this.clearEvents()},setOptions:function(t){t(e.options)},setNodeEvent:function(t,n){var r=e.events[t];r&&n!==r&&(e.nodes[r].events[t]=!1),n?(e.nodes[n].events[t]=!0,e.events[t]=n):e.events[t]=null},setCustom:function(t,n){n(e.nodes[t].data.custom)},setDOM:function(t,n){R(e.nodes[t],N),e.nodes[t].dom=n},setIndicator:function(t){t&&(!t.placement.parent.dom||t.placement.currentNode&&!t.placement.currentNode.dom)||(e.events.indicator=t)},setHidden:function(t,n){e.nodes[t].data.hidden=n},setProp:function(t,n){R(e.nodes[t],N),n(e.nodes[t].data.props)}}},ignoreHistoryForActions:["setDOM","setNodeEvent","clearEvents","setOptions","setIndicator"],normalizeHistory:function(e){Object.keys(e.events).forEach((function(t){var n=e.events[t];n&&!e.nodes[n]&&(e.events[t]=!1)})),Object.keys(e.nodes).forEach((function(t){var n=e.nodes[t];Object.keys(n.events).forEach((function(t){n.events[t]&&!e.events[t]!==n.id&&(n.events[t]=!1)}))}))}},we=function(t){var n=t.children,r=M(t,["children"]),o=function(e){return L(Te,F(F({},Pe),{options:F(F({},Pe.options),e)}),je)}(r);return a((function(){o&&r&&o.actions.setOptions((function(e){}))}),[o,r]),a((function(){o.subscribe((function(e){return{json:o.query.serialize()}}),(function(){o.query.getOptions().onNodesChange(o.query)}))}),[o]),o?e.createElement(Y.Provider,{value:o},e.createElement(K,null,n)):null};export{Canvas,X as DerivedEventHandlers,we as Editor,de as Element,K as Events,ce as Frame,U as NodeContext,Z as NodeProvider,fe as connectEditor,pe as connectNode,ae as defaultElementProps,se as deprecateCanvasComponent,ie as elementPropToNodeData,le as useEditor,J as useEventHandler,ee as useNode};
